!function(T,k,E){T.fn.search=function(u,n){var d,i=T(this),a=i.selector||"",b=(new Date).getTime(),x=[],w=u,C="string"==typeof w,R=[].slice.call(arguments,1);return T(this).each(function(){var o=T.extend(!0,{},T.fn.search.settings,n),f=o.className,p=o.selector,r=o.error,e=o.namespace,s="."+e,t=e+"-module",h=T(this),m=h.find(p.prompt),v=h.find(p.searchButton),g=h.find(p.results),l=(h.find(p.result),h.find(p.category),this),c=h.data(t),y={initialize:function(){y.verbose("Initializing module");var e=m[0],e=e.oninput!==E?"input":e.onpropertychange!==E?"propertychange":"keyup";m.on("focus"+s,y.event.focus).on("blur"+s,y.event.blur).on("keydown"+s,y.handleKeyboard),o.automatic&&m.on(e+s,y.search.throttle),v.on("click"+s,y.search.query),g.on("click"+s,p.result,y.results.select),y.instantiate()},instantiate:function(){y.verbose("Storing instance of module",y),c=y,h.data(t,y)},destroy:function(){y.verbose("Destroying instance"),h.removeData(t)},event:{focus:function(){h.addClass(f.focus),y.results.show()},blur:function(){y.search.cancel(),h.removeClass(f.focus),y.results.hide()}},handleKeyboard:function(e){var s,t=h.find(p.result),r=h.find(p.category),n=e.which,i=13,a=27,o=38,l=40,c=f.active,u=t.index(t.filter("."+c)),d=t.size();if(n==a&&(y.verbose("Escape key pressed, blurring search field"),m.trigger("blur")),0<g.filter(":visible").size())if(n==i){if(y.verbose("Enter key pressed, selecting active result"),0<t.filter("."+c).size())return T.proxy(y.results.select,t.filter("."+c))(),e.preventDefault(),!1}else n==o?(y.verbose("Up key pressed, changing active result"),s=u-1<0?u:u-1,r.removeClass(c),t.removeClass(c).eq(s).addClass(c).closest(r).addClass(c),e.preventDefault()):n==l&&(y.verbose("Down key pressed, changing active result"),s=d<=u+1?u:u+1,r.removeClass(c),t.removeClass(c).eq(s).addClass(c).closest(r).addClass(c),e.preventDefault());else n==i&&(y.verbose("Enter key pressed, executing query"),y.search.query(),v.addClass(f.down),m.one("keyup",function(){v.removeClass(f.down)}))},search:{cancel:function(){var e=h.data("xhr")||!1;e&&"resolved"!=e.state()&&(y.debug("Cancelling last search"),e.abort())},throttle:function(){var e=m.val().length;clearTimeout(y.timer),e>=o.minCharacters?y.timer=setTimeout(y.search.query,o.searchThrottle):y.results.hide()},query:function(){var e=m.val(),s=y.search.cache.read(e);s?(y.debug("Reading result for '"+e+"' from cache"),y.results.add(s)):(y.debug("Querying for '"+e+"'"),"object"==typeof u?y.search.local(e):y.search.remote(e),T.proxy(o.onSearchQuery,h)(e))},local:function(e){var r=[],n=[],s=T.isArray(o.searchFields)?o.searchFields:[o.searchFields],i=new RegExp("(?:s|^)"+e,"i"),a=new RegExp(e,"i");h.addClass(f.loading),T.each(s,function(e,t){T.each(u,function(e,s){"string"==typeof s[t]&&-1==T.inArray(s,r)&&-1==T.inArray(s,n)&&(i.test(s[t])?r.push(s):a.test(s[t])&&n.push(s))})}),s=y.results.generate({results:T.merge(r,n)}),h.removeClass(f.loading),y.search.cache.write(e,s),y.results.add(s)},remote:function(s){var t,e={stateContext:h,url:u,urlData:{query:s},success:function(e){t=y.results.generate(e),y.search.cache.write(s,t),y.results.add(t)},failure:y.error};y.search.cancel(),y.debug("Executing search"),T.extend(!0,e,o.apiSettings),T.api(e)},cache:{read:function(e){var s=h.data("cache");return!(!o.cache||"object"!=typeof s||s[e]===E)&&s[e]},write:function(e,s){var t=h.data("cache")!==E?h.data("cache"):{};t[e]=s,h.data("cache",t)}}},results:{generate:function(e){y.debug("Generating html from response",e);var s=o.templates[o.type],t="";return T.isPlainObject(e.results)&&!T.isEmptyObject(e.results)||T.isArray(e.results)&&0<e.results.length?(0<o.maxResults&&(e.results=T.makeArray(e.results).slice(0,o.maxResults)),0<e.results.length&&(T.isFunction(s)?t=s(e):y.error(r.noTemplate,!1))):t=y.message(r.noResults,"empty"),T.proxy(o.onResults,h)(e),t},add:function(e){"default"!=o.onResultsAdd&&"default"!=T.proxy(o.onResultsAdd,g)(e)||g.html(e),y.results.show()},show:function(){0===g.filter(":visible").size()&&0<m.filter(":focus").size()&&""!==g.html()&&(g.stop().fadeIn(200),T.proxy(o.onResultsOpen,g)())},hide:function(){0<g.filter(":visible").size()&&(g.stop().fadeOut(200),T.proxy(o.onResultsClose,g)())},select:function(e){y.debug("Search result selected");var s,t=T(this),r=t.find(".title").html();"default"!=o.onSelect&&"default"!=T.proxy(o.onSelect,this)(e)||(s=(t=t.find("a[href]").eq(0)).attr("href")||!1,t=t.attr("target")||!1,y.results.hide(),m.val(r),s&&("_blank"==t||e.ctrlKey?k.open(s):k.location.href=s))}},setting:function(e,s){if(T.isPlainObject(e))T.extend(!0,o,e);else{if(s===E)return o[e];o[e]=s}},internal:function(e,s){if(T.isPlainObject(e))T.extend(!0,y,e);else{if(s===E)return y[e];y[e]=s}},debug:function(){o.debug&&(o.performance?y.performance.log(arguments):(y.debug=Function.prototype.bind.call(console.info,console,o.name+":"),y.debug.apply(console,arguments)))},verbose:function(){o.verbose&&o.debug&&(o.performance?y.performance.log(arguments):(y.verbose=Function.prototype.bind.call(console.info,console,o.name+":"),y.verbose.apply(console,arguments)))},error:function(){y.error=Function.prototype.bind.call(console.error,console,o.name+":"),y.error.apply(console,arguments)},performance:{log:function(e){var s,t;o.performance&&(t=(s=(new Date).getTime())-(b||s),b=s,x.push({Element:l,Name:e[0],Arguments:[].slice.call(e,1)||"","Execution Time":t})),clearTimeout(y.performance.timer),y.performance.timer=setTimeout(y.performance.display,100)},display:function(){var e=o.name+":",t=0;b=!1,clearTimeout(y.performance.timer),T.each(x,function(e,s){t+=s["Execution Time"]}),e+=" "+t+"ms",a&&(e+=" '"+a+"'"),1<i.size()&&(e+=" ("+i.size()+")"),(console.group!==E||console.table!==E)&&0<x.length&&(console.groupCollapsed(e),console.table?console.table(x):T.each(x,function(e,s){console.log(s.Name+": "+s["Execution Time"]+"ms")}),console.groupEnd()),x=[]}},invoke:function(r,e,s){var n,i,t,a=c;return e=e||R,s=l||s,"string"==typeof r&&a!==E&&(r=r.split(/[\. ]/),n=r.length-1,T.each(r,function(e,s){var t=e!=n?s+r[e+1].charAt(0).toUpperCase()+r[e+1].slice(1):r;if(T.isPlainObject(a[t])&&e!=n)a=a[t];else{if(a[t]!==E)return i=a[t],!1;{if(!T.isPlainObject(a[s])||e==n)return a[s]!==E&&(i=a[s]),!1;a=a[s]}}})),T.isFunction(i)?t=i.apply(s,e):i!==E&&(t=i),T.isArray(d)?d.push(t):d!==E?d=[d,t]:t!==E&&(d=t),i}};C?(c===E&&y.initialize(),y.invoke(w)):(c!==E&&y.destroy(),y.initialize())}),d!==E?d:this},T.fn.search.settings={name:"Search Module",namespace:"search",debug:!1,verbose:!0,performance:!0,onSelect:"default",onResultsAdd:"default",onSearchQuery:function(){},onResults:function(e){},onResultsOpen:function(){},onResultsClose:function(){},automatic:"true",type:"simple",minCharacters:3,searchThrottle:300,maxResults:7,cache:!0,searchFields:["title","description"],apiSettings:{},className:{active:"active",down:"down",focus:"focus",empty:"empty",loading:"loading"},error:{noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noTemplate:"A valid template name was not specified.",serverError:"There was an issue with querying the server.",method:"The method you called is not defined."},selector:{prompt:".prompt",searchButton:".search.button",results:".results",category:".category",result:".result"},templates:{message:function(e,s){var t="";return t=e!==E&&s!==E?(t+='<div class="message '+s+'">')+("empty"==s?'<div class="header">No Results</div class="header"><div class="description">'+e+'</div class="description">':' <div class="description">'+e+"</div>")+"</div>":t},categories:function(e){var t="";return e.results!==E&&(T.each(e.results,function(e,s){s.results!==E&&0<s.results.length&&(t+='<div class="category"><div class="name">'+s.name+"</div>",T.each(s.results,function(e,s){t=(t+='<div class="result">')+'<a href="'+s.url+'"></a>',s.image!==E&&(t+='<div class="image"> <img src="'+s.image+'"></div>'),t+='<div class="info">',s.price!==E&&(t+='<div class="price">'+s.price+"</div>"),s.title!==E&&(t+='<div class="title">'+s.title+"</div>"),s.description!==E&&(t+='<div class="description">'+s.description+"</div>"),t+="</div></div>"}),t+="</div>")}),e.resultPage&&(t+='<a href="'+e.resultPage.url+'" class="all">'+e.resultPage.text+"</a>"),t)},simple:function(e){var t="";return e.results!==E&&(T.each(e.results,function(e,s){t+='<a class="result" href="'+s.url+'">',s.image!==E&&(t+='<div class="image"> <img src="'+s.image+'"></div>'),t+='<div class="info">',s.price!==E&&(t+='<div class="price">'+s.price+"</div>"),s.title!==E&&(t+='<div class="title">'+s.title+"</div>"),s.description!==E&&(t+='<div class="description">'+s.description+"</div>"),t+="</div></a>"}),e.resultPage&&(t+='<a href="'+e.resultPage.url+'" class="all">'+e.resultPage.text+"</a>"),t)}}}}(jQuery,window,void document);