!function(w,y){w.fn.state=function(e){var u,t=w(this),a=w.extend(!0,{},w.fn.state.settings,e),i=t.selector||"",s=(new Date).getTime(),l=[],d=e,f="string"==typeof d,v=[].slice.call(arguments,1),g=(a.error,a.metadata),b=a.className,n=a.namespace,m=a.states,x=a.text,h="."+n,p=n+"-module";return t.each(function(){var n=w(this),c=this,r=n.data(p),o={initialize:function(){o.verbose("Initializing module"),a.automatic&&o.add.defaults(),a.context&&""!==i?(o.allows("hover")&&w(c,a.context).on(i,"mouseenter"+h,o.enable.hover).on(i,"mouseleave"+h,o.disable.hover),o.allows("down")&&w(c,a.context).on(i,"mousedown"+h,o.enable.down).on(i,"mouseup"+h,o.disable.down),o.allows("focus")&&w(c,a.context).on(i,"focus"+h,o.enable.focus).on(i,"blur"+h,o.disable.focus),w(a.context).on(i,"mouseenter"+h,o.change.text).on(i,"mouseleave"+h,o.reset.text).on(i,"click"+h,o.toggle.state)):(o.allows("hover")&&n.on("mouseenter"+h,o.enable.hover).on("mouseleave"+h,o.disable.hover),o.allows("down")&&n.on("mousedown"+h,o.enable.down).on("mouseup"+h,o.disable.down),o.allows("focus")&&n.on("focus"+h,o.enable.focus).on("blur"+h,o.disable.focus),n.on("mouseenter"+h,o.change.text).on("mouseleave"+h,o.reset.text).on("click"+h,o.toggle.state)),o.instantiate()},instantiate:function(){o.verbose("Storing instance of module",o),r=o,n.data(p,o)},destroy:function(){o.verbose("Destroying previous module",r),n.off(h).removeData(p)},refresh:function(){o.verbose("Refreshing selector cache"),n=w(c)},add:{defaults:function(){var n=e&&w.isPlainObject(e.states)?e.states:{};w.each(a.defaults,function(e,t){o.is[e]!==y&&o.is[e]()&&(o.verbose("Adding default states",e,c),w.extend(a.states,t,n))})}},is:{active:function(){return n.hasClass(b.active)},loading:function(){return n.hasClass(b.loading)},inactive:function(){return!n.hasClass(b.active)},enabled:function(){return!n.is(a.filter.active)},disabled:function(){return n.is(a.filter.active)},textEnabled:function(){return!n.is(a.filter.text)},button:function(){return n.is(".button:not(a, .submit)")},input:function(){return n.is("input")}},allow:function(e){o.debug("Now allowing state",e),m[e]=!0},disallow:function(e){o.debug("No longer allowing",e),m[e]=!1},allows:function(e){return m[e]||!1},enable:{state:function(e){o.allows(e)&&n.addClass(b[e])},focus:function(){n.addClass(b.focus)},hover:function(){n.addClass(b.hover)},down:function(){n.addClass(b.down)}},disable:{state:function(e){o.allows(e)&&n.removeClass(b[e])},focus:function(){n.removeClass(b.focus)},hover:function(){n.removeClass(b.hover)},down:function(){n.removeClass(b.down)}},toggle:{state:function(){var e=n.data(g.promise);o.allows("active")&&o.is.enabled()&&(o.refresh(),e!==y?o.listenTo(e):o.change.state())}},listenTo:function(e){o.debug("API request detected, waiting for state signal",e),e?(x.loading&&o.update.text(x.loading),w.when(e).then(function(){"resolved"==e.state()?(o.debug("API request succeeded"),a.activateTest=function(){return!0},a.deactivateTest=function(){return!0}):(o.debug("API request failed"),a.activateTest=function(){return!1},a.deactivateTest=function(){return!1}),o.change.state()})):(a.activateTest=function(){return!1},a.deactivateTest=function(){return!1})},change:{state:function(){o.debug("Determining state change direction"),o.is.inactive()?o.activate():o.deactivate(),a.sync&&o.sync(),w.proxy(a.onChange,c)()},text:function(){o.is.textEnabled()&&(o.is.active()?x.hover?(o.verbose("Changing text to hover text",x.hover),o.update.text(x.hover)):x.disable&&(o.verbose("Changing text to disable text",x.disable),o.update.text(x.disable)):x.hover?(o.verbose("Changing text to hover text",x.disable),o.update.text(x.hover)):x.enable&&(o.verbose("Changing text to enable text",x.enable),o.update.text(x.enable)))}},activate:function(){w.proxy(a.activateTest,c)()&&(o.debug("Setting state to active"),n.addClass(b.active),o.update.text(x.active)),w.proxy(a.onActivate,c)()},deactivate:function(){w.proxy(a.deactivateTest,c)()&&(o.debug("Setting state to inactive"),n.removeClass(b.active),o.update.text(x.inactive)),w.proxy(a.onDeactivate,c)()},sync:function(){o.verbose("Syncing other buttons to current state"),o.is.active()?t.not(n).state("activate"):t.not(n).state("deactivate")},get:{text:function(){return a.selector.text?n.find(a.selector.text).text():n.html()},textFor:function(e){return x[e]||!1}},flash:{text:function(e,t){var n=o.get.text();o.debug("Flashing text message",e,t),e=e||a.text.flash,t=t||a.flashDuration,o.update.text(e),setTimeout(function(){o.update.text(n)},t)}},reset:{text:function(){var e=x.active||n.data(g.storedText),t=x.inactive||n.data(g.storedText);o.is.textEnabled()&&(o.is.active()&&e?(o.verbose("Resetting active text",e),o.update.text(e)):t&&(o.verbose("Resetting inactive text",e),o.update.text(t)))}},update:{text:function(e){var t=o.get.text();e&&e!==t?(o.debug("Updating text",e),a.selector.text?n.data(g.storedText,e).find(a.selector.text).text(e):n.data(g.storedText,e).html(e)):o.debug("Text is already sane, ignoring update",e)}},setting:function(e,t){if(o.debug("Changing setting",e,t),t===y)return a[e];w.isPlainObject(e)?w.extend(!0,a,e):a[e]=t},internal:function(e,t){if(o.debug("Changing internal",e,t),t===y)return o[e];w.isPlainObject(e)?w.extend(!0,o,e):o[e]=t},debug:function(){a.debug&&(a.performance?o.performance.log(arguments):(o.debug=Function.prototype.bind.call(console.info,console,a.name+":"),o.debug.apply(console,arguments)))},verbose:function(){a.verbose&&a.debug&&(a.performance?o.performance.log(arguments):(o.verbose=Function.prototype.bind.call(console.info,console,a.name+":"),o.verbose.apply(console,arguments)))},error:function(){o.error=Function.prototype.bind.call(console.error,console,a.name+":"),o.error.apply(console,arguments)},performance:{log:function(e){var t,n;a.performance&&(n=(t=(new Date).getTime())-(s||t),s=t,l.push({Element:c,Name:e[0],Arguments:[].slice.call(e,1)||"","Execution Time":n})),clearTimeout(o.performance.timer),o.performance.timer=setTimeout(o.performance.display,100)},display:function(){var e=a.name+":",n=0;s=!1,clearTimeout(o.performance.timer),w.each(l,function(e,t){n+=t["Execution Time"]}),e+=" "+n+"ms",i&&(e+=" '"+i+"'"),1<t.size()&&(e+=" ("+t.size()+")"),(console.group!==y||console.table!==y)&&0<l.length&&(console.groupCollapsed(e),console.table?console.table(l):w.each(l,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),l=[]}},invoke:function(o,e,t){var a,i,n,s=r;return e=e||v,t=c||t,"string"==typeof o&&s!==y&&(o=o.split(/[\. ]/),a=o.length-1,w.each(o,function(e,t){var n=e!=a?t+o[e+1].charAt(0).toUpperCase()+o[e+1].slice(1):o;if(w.isPlainObject(s[n])&&e!=a)s=s[n];else{if(s[n]!==y)return i=s[n],!1;{if(!w.isPlainObject(s[t])||e==a)return s[t]!==y&&(i=s[t]),!1;s=s[t]}}})),w.isFunction(i)?n=i.apply(t,e):i!==y&&(n=i),w.isArray(u)?u.push(n):u!==y?u=[u,n]:n!==y&&(u=n),i}};f?(r===y&&o.initialize(),o.invoke(d)):(r!==y&&o.destroy(),o.initialize())}),u!==y?u:this},w.fn.state.settings={name:"State",debug:!0,verbose:!0,namespace:"state",performance:!0,onActivate:function(){},onDeactivate:function(){},onChange:function(){},activateTest:function(){return!0},deactivateTest:function(){return!0},automatic:!0,sync:!1,flashDuration:3e3,filter:{text:".loading, .disabled",active:".disabled"},context:!1,error:{method:"The method you called is not defined."},metadata:{promise:"promise",storedText:"stored-text"},className:{focus:"focus",hover:"hover",down:"down",active:"active",loading:"loading"},selector:{text:!1},defaults:{input:{hover:!0,focus:!0,down:!0,loading:!1,active:!1},button:{hover:!0,focus:!1,down:!0,active:!0,loading:!0}},states:{hover:!0,focus:!0,down:!0,loading:!1,active:!1},text:{flash:!1,hover:!1,active:!1,inactive:!1,enable:!1,disable:!1}}}(jQuery,(window,void document));