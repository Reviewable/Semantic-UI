!function(b,v,x){b.api=b.fn.api=function(e){var s,c=b.extend(!0,{},b.api.settings,e),t="function"!=typeof this?this:b("<div/>"),a=c.stateContext?b(c.stateContext):b(t),l="object"==typeof this?b(t):a,u=this,o=(new Date).getTime(),n=[],i=l.selector||"",t=c.namespace+"-module",d=c.className,f=c.metadata,p=c.error,g=l.data(t),t=e,r=g!==x&&"string"==typeof t,m=[].slice.call(arguments,1),h={initialize:function(){var e,n,t,r=(new Date).getTime(),o={};if(c.serializeForm&&b(this).toJSON()!==x&&(t=h.get.formData(),h.debug("Adding form data to API Request",t),b.extend(!0,c.data,t)),(t=b.proxy(c.beforeSend,l)(c))===x||t)return(t=h.get.url(h.get.templateURL()))?(n=b.Deferred().always(function(){c.stateContext&&a.removeClass(d.loading),b.proxy(c.complete,l)()}).done(function(e){h.debug("API request successful"),"json"==c.dataType?e.error!==x?b.proxy(c.failure,a)(e.error,c,l):b.isArray(e.errors)?b.proxy(c.failure,a)(e.errors[0],c,l):b.proxy(c.success,a)(e,c,l):b.proxy(c.success,a)(e,c,l)}).fail(function(e,t,r){var o,n=c.error[t]!==x?c.error[t]:r;if(e!==x)if(e.readyState!==x&&4==e.readyState){if(200!=e.status&&r!==x&&""!==r)h.error(p.statusMessage+r);else if("error"==t&&"json"==c.dataType)try{(o=b.parseJSON(e.responseText))&&o.error!==x&&(n=o.error)}catch(e){h.error(e.JSONParse)}a.removeClass(d.loading).addClass(d.error),0<c.errorLength&&setTimeout(function(){a.removeClass(d.error)},c.errorLength),h.debug("API Request error:",n),b.proxy(c.failure,a)(n,c,this)}else h.debug("Request Aborted (Most likely caused by page change)")}),b.extend(!0,o,c,{success:function(){},failure:function(){},complete:function(){},type:c.method||c.type,data:void 0,url:t,beforeSend:c.beforeXHR}),c.stateContext&&a.addClass(d.loading),c.progress&&(h.verbose("Adding progress events"),b.extend(!0,o,{xhr:function(){var e=new v.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){var t;e.lengthComputable&&(t=Math.round(e.loaded/e.total*1e4)/100+"%",b.proxy(c.progress,a)(t,e))},!1),e.addEventListener("progress",function(e){var t;e.lengthComputable&&(t=Math.round(e.loaded/e.total*1e4)/100+"%",b.proxy(c.progress,a)(t,e))},!1),e}})),h.verbose("Creating AJAX request with settings: ",o),t=b.ajax(o).always(function(){e=c.loadingLength-((new Date).getTime()-r),c.loadingDelay=e<0?0:e}).done(function(e){var t=this;setTimeout(function(){n.resolveWith(t,[e])},c.loadingDelay)}).fail(function(e,t,r){var o=this;"abort"!=t?setTimeout(function(){n.rejectWith(o,[e,t,r])},c.loadingDelay):a.removeClass(d.error).removeClass(d.loading)}),void(c.stateContext&&l.data(f.promise,n).data(f.xhr,t))):(h.error(p.missingURL),void h.reset());h.error(p.beforeSend),h.reset()},get:{formData:function(){return l.closest("form").toJSON()},templateURL:function(){var e,t=l.data(c.metadata.action)||c.action||!1;return t&&(h.debug("Creating url for: ",t),c.api[t]!==x?e=c.api[t]:h.error(p.missingAction)),c.url&&(e=c.url,h.debug("Getting url",e)),e},url:function(n,a){var i;return n&&(i=n.match(c.regExpTemplate),a=a||c.urlData,i&&(h.debug("Looking for URL variables",i),b.each(i,function(e,t){var r=t.substr(2,t.length-3),o=(!b.isPlainObject(a)||a[r]===x)&&l.data(r)!==x?l.data(r):a[r];if(h.verbose("Looking for variable",r,l,l.data(r),a[r]),!1===o)h.debug("Removing variable from URL",i),n=n.replace("/"+t,"");else{if(o===x||!o)return h.error(p.missingParameter+r),n=!1;n=n.replace(t,o)}}))),n}},reset:function(){l.data(f.promise,!1).data(f.xhr,!1),a.removeClass(d.error).removeClass(d.loading)},setting:function(e,t){if(b.isPlainObject(e))b.extend(!0,c,e);else{if(t===x)return c[e];c[e]=t}},internal:function(e,t){if(b.isPlainObject(e))b.extend(!0,h,e);else{if(t===x)return h[e];h[e]=t}},debug:function(){c.debug&&(c.performance?h.performance.log(arguments):(h.debug=Function.prototype.bind.call(console.info,console,c.name+":"),h.debug.apply(console,arguments)))},verbose:function(){c.verbose&&c.debug&&(c.performance?h.performance.log(arguments):(h.verbose=Function.prototype.bind.call(console.info,console,c.name+":"),h.verbose.apply(console,arguments)))},error:function(){h.error=Function.prototype.bind.call(console.error,console,c.name+":"),h.error.apply(console,arguments)},performance:{log:function(e){var t,r;c.performance&&(r=(t=(new Date).getTime())-(o||t),o=t,n.push({Element:u,Name:e[0],Arguments:[].slice.call(e,1)||"","Execution Time":r})),clearTimeout(h.performance.timer),h.performance.timer=setTimeout(h.performance.display,100)},display:function(){var e=c.name+":",r=0;o=!1,clearTimeout(h.performance.timer),b.each(n,function(e,t){r+=t["Execution Time"]}),e+=" "+r+"ms",i&&(e+=" '"+i+"'"),(console.group!==x||console.table!==x)&&0<n.length&&(console.groupCollapsed(e),console.table?console.table(n):b.each(n,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),n=[]}},invoke:function(o,e,t){var n,a,r,i=g;return e=e||m,t=u||t,"string"==typeof o&&i!==x&&(o=o.split(/[\. ]/),n=o.length-1,b.each(o,function(e,t){var r=e!=n?t+o[e+1].charAt(0).toUpperCase()+o[e+1].slice(1):o;if(b.isPlainObject(i[r])&&e!=n)i=i[r];else{if(i[r]!==x)return a=i[r],!1;{if(!b.isPlainObject(i[t])||e==n)return i[t]!==x&&(a=i[t]),!1;i=i[t]}}})),b.isFunction(a)?r=a.apply(t,e):a!==x&&(r=a),b.isArray(s)?s.push(r):s!==x?s=[s,r]:r!==x&&(s=r),a}};return r?(g===x&&h.initialize(),h.invoke(t)):(g!==x&&h.destroy(),h.initialize()),s!==x?s:this},b.fn.apiButton=function(n){return b(this).each(function(){var e=b(this),t=b(this).selector||"",r=b.isFunction(n)?b.extend(!0,{},b.api.settings,b.fn.apiButton.settings,{stateContext:this,success:n}):b.extend(!0,{},b.api.settings,b.fn.apiButton.settings,{stateContext:this},n),o={initialize:function(){r.context&&""!==t?b(r.context).on(t,"click."+r.namespace,o.click):e.on("click."+r.namespace,o.click)},click:function(){r.filter&&0!==b(this).filter(r.filter).size()||b.proxy(b.api,this)(r)}};o.initialize()}),this},b.api.settings={name:"API",namespace:"api",debug:!0,verbose:!0,performance:!0,api:{},beforeSend:function(e){return e},beforeXHR:function(e){},success:function(e){},complete:function(e){},failure:function(e){},progress:!1,error:{missingAction:"API action used but no url was defined",missingURL:"URL not specified for the API action",missingParameter:"Missing an essential URL parameter: ",timeout:"Your request timed out",error:"There was an error with your request",parseError:"There was an error parsing your request",JSONParse:"JSON could not be parsed during error handling",statusMessage:"Server gave an error: ",beforeSend:"The before send function has aborted the request",exitConditions:"API Request Aborted. Exit conditions met"},className:{loading:"loading",error:"error"},metadata:{action:"action",promise:"promise",xhr:"xhr"},regExpTemplate:/\{\$([A-z]+)\}/g,action:!1,url:!1,urlData:!1,serializeForm:!1,stateContext:!1,method:"get",data:{},dataType:"json",cache:!0,loadingLength:200,errorLength:2e3},b.fn.apiButton.settings={filter:".disabled, .loading",context:!1,stateContext:!1}}(jQuery,window,void document);